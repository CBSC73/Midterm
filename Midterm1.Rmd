---
title: "Midterm"
author: "CB"
date: "`r Sys.Date()`"
output: github_document
always_allow_html: true
---

```{r setup, include=FALSE} 
knitr::opts_chunk$set(echo = TRUE)
```

# **Title: Influenza Vaccine Uptake by Region and Age Group from 2012-2019 in the United States**
## **Introduction: Pregnant women and newborns are at higher risk for severe illness from Influenza virus infection(Ref). Influenza during pregnancy can lead to severe maternal respiratory illness requiring hospitalization. It can also be a serious condition for infants (babies under 1 year of age), especially during the neonatal period (first 30 days of life) and for those with pre-existing respiratory conditions such as bronchopulmonary dysplasia (Ref). The yearly influenza vaccine has a long track record of safety and efficacy during pregnancy and is recommended by the Centers for Disease Control (CDC) for all pregnant women (Ref). Despite this recommendation, only approximately 50% of women receive the influenza vaccine during pregnancy (ref). The objective of this qualitative data analysis is two fold, first to examine factors associated with low vaccine uptake. Specifically, age group and location. Second, to examine these trends over time to see whether uptake is increasing or decreasing. Identifying those pregnant women less likely to get vaccinated can help inform where efforts to promote vaccine utilization are needed most.**   

```{r, Load required libraries}
library(data.table)
library(dplyr)
library(tidyverse)
library(leaflet)
library(dtplyr)
library(knitr)
library(ggplot2)
```

```{r}
library(readr)
Vaccination_Coverage_among_Pregnant_Women_3_ <- read_csv("C:/Users/clair/Desktop/PM566/Vaccination_Coverage_among_Pregnant_Women (3).csv", 
    col_types = cols(`Survey Year_Influenza Season` = col_integer(), 
        Estimate = col_number(), `95CI` = col_skip(), 
        `Sample Size` = col_number()))
```

```{r, rename dataset, look at variables}
vaxdata<-Vaccination_Coverage_among_Pregnant_Women_3_
dim(vaxdata)
```

```{r, explore what options are in each variable}
head(vaxdata)
unique(vaxdata$Vaccine)
unique(vaxdata$'Geography Type')
unique(vaxdata$Geography)
unique(vaxdata$'Survey Year_Influenza Season')
unique(vaxdata$'Dimension Type')
unique(vaxdata$Dimension)
```

```{r, subset data to include age dimension only}
vaxdata1<-subset(vaxdata, `Dimension Type`=="Age")
table(vaxdata1$'Dimension Type')
```
```{r, check for missing values}
colSums(is.na(vaxdata1))
```
```{r, remove NAs from dataset given there are only 15 out of 1824 rows (<1%) in my variable of interest, vaccination uptake ("Estimate")}
vaxdata1<-vaxdata1 %>% drop_na(Estimate)
```

```{r, make into a data table}
dim(vaxdata1)
vaxdata_DT=as.data.table(vaxdata1)
is.data.table(vaxdata_DT)

```

```{r, summary statistics on variable of interest}
summary(vaxdata_DT$Estimate)
```


```{r, divide U.S into regions using CDC breakdown}
vaxdata_DT_region <-vaxdata_DT [, region := fifelse(Geography== "Alaska"| Geography=="Arizona" | Geography=="California" | Geography=="Colorado"| Geography=="Hawaii"| Geography=="Idaho"| Geography=="Montana"| Geography=="Nevada"| Geography=="New Mexico"| Geography=="Oregon"| Geography=="Utah"| Geography=="Washington"|Geography== "Wyoming", "WEST",
                fifelse(Geography=="Alabama"|Geography=="Arkansas"|Geography== "Delaware" |Geography== "District of Columbia"| Geography=="Florida"|Geography== "Georgia" | Geography=="Kentucky" |Geography== "Louisiana"|Geography== "Maryland" | Geography=="Mississippi" |Geography=="North Carolina"|Geography=="Oklahoma"| Geography=="South Carolina"| Geography=="Tennessee" |Geography=="Texas"|Geography== "Virginia"|Geography== "West Virginia", "SOUTH",
                fifelse(Geography=="Illinois"| Geography=="Indiana"| Geography=="Iowa"|Geography== "Kansas"| Geography=="Michigan"|Geography== "Minnesota"| Geography=="Missouri"| Geography=="Nebraska"| Geography=="North Dakota"| Geography=="Ohio"|Geography=="South Dakota"|Geography=="Wisconsin", "MIDWEST",
                fifelse(Geography=="Puerto Rico"|Geography=="United States", "",
                        "NORTHEAST"))))]

```
```{r, make into data table}
table(vaxdata_DT_region$region)
vaxdata_DT_region<-as.data.table(vaxdata_DT_region)
is.data.table(vaxdata_DT_region)
```
```{r, drop NAs}
vaxdata_DT_region<-subset(vaxdata_DT_region, `region`!="")

table(vaxdata_DT_region$region)
```
```{r}
unique(vaxdata_DT_region$"Survey Year_Influenza Season")
```
```{r}
mean(vaxdata_DT$Estimate)
```


```{r, rename variables}
vaxdata1<-vaxdata1 %>% rename(Year="Survey Year_Influenza Season")
vaxdata1<-vaxdata1 %>% rename(Age= "Dimension")
tail(vaxdata1)
```
```{r}
vaxdata1<-distinct(vaxdata1)
```
```{r}
vaxdata1%>%
  filter(Geography=="United States", Vaccine == "Influenza", Age !=">=18 Years") %>% 
  ggplot(aes(x=Year, fill= Age, y=Estimate)) +   
  geom_col(color="black", position="dodge")+
  labs(title="Influenza Vaccination Rate Among Pregnant Women in the U.S. 2012-2019", x="Year", y= "Vaccination Rate (%)")+
scale_fill_brewer(palette = "Blues")

```
```{r}
vaxdata1%>%
  filter(Geography=="United States", Vaccine == "Tdap", Age !=">=18 Years") %>% 
  ggplot(aes(x=Year, fill= Age, y=Estimate)) +   
  geom_col(color="black", position="dodge")+
  labs(title="Tdap Vaccination Rate Among Pregnant Women in the U.S. 2012-2019", x="Year", y= "Vaccination Rate (%)")+
scale_fill_brewer(palette = "Purples")
```
 
```{r}
vaxdata_DF_region <- as.data.frame(vaxdata_DT_region)
```
```{r}
vaxdata_DF_region%>%
  filter(Geography!="United States" & Geography != "Puerto Rico", Vaccine == "Influenza", Dimension ==">=18 Years", `Survey Year_Influenza Season` ==2019) %>% 
  ggplot(aes( fill=  region, y=Estimate)) +   
  geom_boxplot(color="black")+
  labs(title="Influenza Vaccination Rate Among Pregnant Women in the U.S. 2019",  y= "Vaccination Rate (%)")+
scale_fill_brewer(palette = "Reds")+
  facet_wrap(~ region, nrow = 1)
```
```{r}
vaxdata_DF_region%>%
  filter(Geography!="United States" & Geography != "Puerto Rico", Vaccine == "Influenza", Dimension ==">=18 Years", `Survey Year_Influenza Season` ==2012) %>% 
  ggplot(aes( fill=  region, y=Estimate)) +   
  geom_boxplot(color="black")+
  labs(title="Influenza Vaccination Rate Among Pregnant Women in the U.S. 2012",  y= "Vaccination Rate (%)")+
scale_fill_brewer(palette = "Reds")+
  facet_wrap(~ region, nrow = 1)
```
```{r}
vaxdata_DF_region<-vaxdata_DF_region %>% rename(Year="Survey Year_Influenza Season")
vaxdata_DF_region$Year <-as.character(vaxdata_DF_region$Year)
```
```{r}
vaxdata_DF_region%>%
  filter(Geography!="United States" & Geography != "Puerto Rico", Vaccine == "Influenza", Dimension ==">=18 Years", Year == 2012 | Year == 2019) %>% 
  ggplot(aes(y=Estimate, x = Year, fill = Year)) +   
  geom_boxplot(color="black")+
  labs(title="Influenza Vaccination Rate Among Pregnant Women in the U.S. 2012 vs 2019",  y= "Vaccination Rate (%)")+
scale_fill_brewer(palette = "Greens")+
  facet_wrap(~region, nrow=1)

```



